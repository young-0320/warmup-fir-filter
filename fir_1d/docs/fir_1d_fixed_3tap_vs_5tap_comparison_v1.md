# FIR 1D Fixed 3-Tap vs 5-Tap 성능 비교표 (Rev 1.0)

비교 기준:

- 본 문서는 `fixed 3tap`과 `fixed 5tap`의 품질을 직접 비교한다.
- 수치는 각 탭 리포트의 `fixed - ideal` 오차 지표를 사용하였다.
- 입력/케이스 수는 동일(`7 images x 4 coeff = 28 cases`)하다.

원본 리포트:

- `fir_1d/sim/vector/output/report_3tap/compare_3tap_cases.csv`
- `fir_1d/sim/vector/output/report_5tap/compare_5tap_cases.csv`

---

## 1. 전체 비교 (케이스 단순 평균)

| Metric            |    3tap |    5tap | Delta (5-3) | Delta % |
| ----------------- | ------: | ------: | ----------: | ------: |
| MAE               |  2.4078 |  1.1302 |     -1.2776 | -53.06% |
| RMSE              |  5.8063 |  2.9380 |     -2.8683 | -49.40% |
| max_abs_err       | 68.4494 | 46.4103 |    -22.0391 | -32.20% |
| mean_err          |  2.2903 |  0.8871 |     -1.4032 | -61.27% |
| clip_needed_ratio |  0.1024 |  0.1137 |     +0.0114 | +11.09% |
| sat_ratio         |  0.2440 |  0.2579 |     +0.0140 |  +5.73% |

---

## 2. 전체 비교 (샘플 수 가중 평균)

| Metric                     |   3tap |   5tap | Delta (5-3) | Delta % |
| -------------------------- | -----: | -----: | ----------: | ------: |
| weighted_MAE               | 0.6592 | 0.3243 |     -0.3349 | -50.80% |
| weighted_RMSE              | 2.6526 | 1.2739 |     -1.3787 | -51.98% |
| weighted_mean_err          | 0.6067 | 0.2343 |     -0.3725 | -61.39% |
| weighted_clip_needed_ratio | 0.0498 | 0.0582 |     +0.0084 | +16.80% |
| weighted_sat_ratio         | 0.6567 | 0.6661 |     +0.0094 |  +1.44% |

---

## 3. 계수별 비교 (샘플 수 가중 평균)

| Coeff      | MAE 3tap | MAE 5tap | Delta % | RMSE 3tap | RMSE 5tap |  Delta % |
| ---------- | -------: | -------: | ------: | --------: | --------: | -------: |
| edge       |   2.3587 |   0.9230 | -60.87% |    9.9785 |    3.7839 |  -62.08% |
| moving_avg |   0.0877 |   0.0993 | +13.23% |    0.1648 |    0.1757 |   +6.61% |
| sharpen    |   0.0963 |   0.1763 | +83.12% |    0.2883 |    0.9617 | +233.56% |
| simple_lp  |   0.0941 |   0.0986 |  +4.73% |    0.1787 |    0.1742 |   -2.50% |

| Coeff      | max_abs_err 3tap | max_abs_err 5tap |  Delta % | clip_needed_ratio 3tap | clip_needed_ratio 5tap | Delta % | sat_ratio 3tap | sat_ratio 5tap | Delta % |
| ---------- | ---------------: | ---------------: | -------: | ---------------------: | ---------------------: | ------: | -------------: | -------------: | ------: |
| edge       |         235.6783 |          88.1210 |  -62.61% |                 0.1736 |                 0.1902 |  +9.55% |         0.8206 |         0.8509 |  +3.69% |
| moving_avg |           0.3333 |           0.4000 |  +20.00% |                 0.0000 |                 0.0000 |   0.00% |         0.5981 |         0.5954 |  -0.44% |
| sharpen    |          24.4485 |          71.7712 | +193.56% |                 0.0257 |                 0.0426 | +65.75% |         0.6116 |         0.6215 |  +1.62% |
| simple_lp  |           0.5000 |           0.5000 |    0.00% |                 0.0000 |                 0.0000 |   0.00% |         0.5965 |         0.5967 |  +0.03% |

---

## 4. 빠른 요약

| 관점                           | 우세 탭                      |
| ------------------------------ | ---------------------------- |
| 전체 오차(MAE/RMSE, 단순/가중) | 5tap 우세                    |
| edge 계수 오차                 | 5tap 우세                    |
| sharpen 계수 오차              | 3tap 우세                    |
| moving_avg 계수 오차           | 3tap 우세 (소폭)             |
| simple_lp 계수 오차            | 유사 (RMSE는 5tap 소폭 우세) |

---

## 5. 가설 기반 결론 (왜 탭 수 증가가 항상 개선으로 이어지지 않았는가)

본 결과만 보면 "탭 수 증가 = 무조건 품질 개선"으로 단정하기는 어렵다.오히려 아래 요인이 함께 작용했을 가능성이 있다.

1. 연산 단계 증가에 따른 오차 누적 가능성

- 5tap은 3tap 대비 MAC 단계가 늘어나므로 반올림/양자화 오차의 축적 경로가 많아진다.
- `moving_avg`에서 5tap이 3tap 대비 소폭 악화(`RMSE +6.61%`)된 현상은 이 영향과 관련 있을 가능성이 있다.

2. 탭 수 증가와 함께 계수 구조 자체가 변경됨

- 탭 수가 늘면 단순히 정밀도만 좋아지는 것이 아니라, 필터의 주파수 응답과 피크 분포가 달라진다.
- `sharpen`의 경우 5tap에서 high-gain 성향이 강해지며 `RMSE +233.56%`, `clip_needed_ratio +65.75%`로 악화되었다.

3. 출력 포맷(`uint8`) clipping 민감도

- `edge/sharpen`처럼 음수/overshoot가 많은 계수는 `uint8`로 투영될 때 정보 손실이 커진다.
- 이 때문에 계산 구조가 더 정교해져도 최종 출력 포맷 제약에서 성능 이득이 상쇄될 수 있다.

요약하면, 현재 데이터는 "탭 수 자체"보다는 "계수 설계 + 출력 포맷 제약의 상호작용"이 오차를 더 크게 결정한다는 가설을 지지한다.
